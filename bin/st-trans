#!/bin/bash

# Selected text translator by ibrahim mohammad
# Email: ibrahim.mohammad.2015@gmail.com
# GitHub repository: https://github.com/IbrahimMohammad/shell_script
# No Rights Reserved

help () {
    echo "Usage: st-trans [<OPTIONS>|<[SOURCE]:[TARGET]>]

Options
-l
show a list of supported languages and codes.

-k
change shortcut key.

-h
print this help and exit.

-t
change timeout period.

-u
change the urgency level.

-c
run st-trans in command mode, translate selection when shortcut key pressed (defalt mode).

-i
run st-trans in instant translation mode, translate selection instantly.

Language preferences
[SOURCE]:[TARGET]
To change source and target language use
SOURCE-CODE:TARGET-CODE
For example to translate from English to French use this command
st-trans en:fr

Also you can change just one language either source by
SOURCE:
For example
st-trans en:
or target
:TARGET
For example
st-trans :fr
You can use auto as the source language to auto detect source language
st-trans auto:"
}

if [ -n "$1" ]; then # options
    # print languages table
    if [ "$1" == "-l" ]; then
        echo "┌──────────────────────┬───────────────────────┬───────────────────────┐
│Language Name    Code │Language Name     Code │Language Name     Code │ 
│──────────────────────│───────────────────────│───────────────────────│ 
│ Afrikaans      - af  │ Hawaiian        - haw │ Portuguese      - pt  │ 
│ Albanian       - sq  │ Hebrew          - he  │ Punjabi         - pa  │ 
│ Amharic        - am  │ Hindi           - hi  │ Romanian        - ro  │ 
│ Arabic         - ar  │ Hmong           - hmn │ Romansh         - rm  │ 
│ Armenian       - hy  │ Hungarian       - hu  │ Russian         - ru  │ 
│ Assamese       - as  │ Icelandic       - is  │ Samoan          - sm  │ 
│ Azerbaijani    - az  │ Igbo            - ig  │ Scottish Gaelic - gd  │ 
│ Bashkir        - ba  │ Indonesian      - id  │ Serbian         - sr  │ 
│ Basque         - eu  │ Interlingue     - ie  │ Sesotho         - st  │ 
│ Belarusian     - be  │ Irish           - ga  │ Shona           - sn  │ 
│ Bengali        - bn  │ Italian         - it  │ Sindhi          - sd  │ 
│ Bosnian        - bs  │ Japanese        - ja  │ Sinhala         - si  │ 
│ Breton         - br  │ Javanese        - jv  │ Slovak          - sk  │ 
│ Bulgarian      - bg  │ Kannada         - kn  │ Slovenian       - sl  │ 
│ Catalan        - ca  │ Kazakh          - kk  │ Somali          - so  │ 
│ Cebuano        - ceb │ Khmer           - km  │ Spanish         - es  │ 
│ Cherokee       - chr │ Kinyarwanda     - rw  │ Sundanese       - su  │ 
│ Chichewa       - ny  │ Korean          - ko  │ Swahili         - sw  │ 
│ Chinese Simp.  - zh-CN Kurdish         - ku  │ Swedish         - sv  │ 
│ Chinese Trad.  - zh-TW Kyrgyz          - ky  │ Tajik           - tg  │ 
│ Corsican       - co  │ Lao             - lo  │ Tamil           - ta  │ 
│ Croatian       - hr  │ Latin           - la  │ Tatar           - tt  │ 
│ Czech          - cs  │ Latvian         - lv  │ Telugu          - te  │ 
│ Danish         - da  │ Lithuanian      - lt  │ Thai            - th  │ 
│ Dutch          - nl  │ Luxembourgish   - lb  │ Tibetan         - bo  │ 
│ Dzongkha       - dz  │ Macedonian      - mk  │ Tigrinya        - ti  │ 
│ English        - en  │ Malagasy        - mg  │ Turkish         - tr  │ 
│ Esperanto      - eo  │ Malay           - ms  │ Turkmen         - tk  │ 
│ Estonian       - et  │ Malayalam       - ml  │ Ukrainian       - uk  │ 
│ Faroese        - fo  │ Maltese         - mt  │ Urdu            - ur  │ 
│ Fijian         - fj  │ Maori           - mi  │ Uyghur          - ug  │ 
│ Filipino       - tl  │ Marathi         - mr  │ Uzbek           - uz  │ 
│ Finnish        - fi  │ Mongolian       - mn  │ Vietnamese      - vi  │ 
│ French         - fr  │ Myanmar         - my  │ Volapük         - vo  │ 
│ Galician       - gl  │ Nepali          - ne  │ Welsh           - cy  │ 
│ Georgian       - ka  │ Norwegian       - no  │ Western Frisian - fy  │ 
│ German         - de  │ Occitan         - oc  │ Wolof           - wo  │ 
│ Greek          - el  │ Oriya           - or  │ Xhosa           - xh  │ 
│ Guarani        - gn  │ Oromo           - om  │ Yiddish         - yi  │ 
│ Gujarati       - gu  │ Pashto          - ps  │ Yoruba          - yo  │ 
│ Haitian Creole - ht  │ Persian         - fa  │ Zulu            - zu  │ 
│ Hausa          - ha  │ Polish          - pl  │                       │
└──────────────────────┴───────────────────────┴───────────────────────┘"
        exit 0
    # change languages
    elif echo "$1" | grep -qF ':'; then
        curr_source_lang="$(cut -sd \& -f 2 ~/.st-trans)"
        curr_target_lang="$(cut -sd \& -f 3 ~/.st-trans)"
        new_source_lang="$(echo "$1" | cut -sd \: -f 1)"
        new_target_lang="$(echo "$1" | cut -sd \: -f 2)"
        # change source language
		if [ -n "$new_source_lang" ]; then
        sed -i "5s/$curr_source_lang/sl=$new_source_lang/" ~/.st-trans
		fi
        # change target languade
		if [ -n "$new_target_lang" ]; then
        sed -i "5s/$curr_target_lang/tl=$new_target_lang/" ~/.st-trans
		fi
    # change shortcut key
    elif [ "$1" == "-k" ]; then
        echo "Please press combination of keys to set your new shortcut key"
        new_key="$(xbindkeys -k | sed -n '$p')"
        # check if user enter new shortcut key
        if [ "$new_key" == 'in $HOME/.xbindkeysrc to bind a key.' ]; then
            echo "nothing change"
        else
            curr_key="$(sed -n '/\~\/\.st-trans/{n;p;}' ~/.xbindkeysrc)"
            sed -i "s/$curr_key/$new_key/" ~/.xbindkeysrc
	    xbindkeys
        fi

	#Change timeout period
    elif [ "$1" == "-t" ]; then

		#ensure that $2 exist
        if ! [ -n "$2" ]; then	    
            help
			exit 1
	    fi
			currentTime=$(tail -n 1 ~/.st-trans | cut -sd  \   -f 5)

			
			#Check that input is integer
			if ! [ "$2" -eq "$2" ] 2> /dev/null ;then
					    echo "Sorry integers only"
						exit 1
			fi

			timeout=$(($2*1000))

			sed -i "s/-t $currentTime/-t $timeout/" ~/.st-trans
			
			
	#Change urgency level:
    elif [ "$1" == "-u" ]; then
		#ensure that $2 exist
        if ! [ -n "$2" ]; then	    
            help
			exit 1
	    fi
	
		#Check that input is integer
		if ! [ "$2" -eq "$2" ] 2> /dev/null ;then
			echo "Sorry integers only"
			exit 1
		fi

		currentLevel=$(tail -n 1 ./.st-trans | cut -sd  \  -f 3)

		case $2 in
			0)    nextLevel='low'
							;;

			1)    nextLevel='normal'
							;;

			2)    nextLevel='critical'
							;;

			*)    echo "invalid number."
			      help
		          exit 1
							;;
			esac

			sed -i "s/-u $currentLevel/-u $nextLevel/" ~/.st-trans
    # instant translation mode
    elif [ "$1" == "-i" ]; then
        # check if the daemon already running if not run it
        if pgrep -l st-trans-daemon &> /dev/null; then
	    echo 'Instant translation mode already running.'
	else
	    st-trans-daemon
            echo 'Instant translation mode activated.'
	fi
    # command mode
    elif [ "$1" == "-c" ]; then
        if killall st-trans-daemon &> /dev/null; then
	    echo 'Command mode activated.'
	else
	    echo 'Command mode already running.'
	fi
    # show help option
    elif [ "$1" == "-h" ]; then
    help
    # more options with elif
    else
    help
    exit 1
    fi
else
help
fi
